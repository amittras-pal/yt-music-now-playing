(function(){"use strict";self.onmessage=async t=>{const a=await createImageBitmap(t.data),n=new OffscreenCanvas(a.width,a.height),r=n.getContext("2d");r==null||r.drawImage(a,0,0);const e=r==null?void 0:r.getImageData(0,0,n.width,n.height),o=m(e),c=b(o,0),s=d(c),u=f(s);self.postMessage(u)};function b(t,a){if(a===3||t.length===0){const e=t.reduce((o,c)=>(o.r+=c.r,o.g+=c.g,o.b+=c.b,o),{r:0,g:0,b:0});return e.r=Math.round(e.r/t.length),e.g=Math.round(e.g/t.length),e.b=Math.round(e.b/t.length),[e]}const n=M(t);t.sort((e,o)=>e[n]-o[n]);const r=t.length/2;return[...b(t.slice(0,r),a+1),...b(t.slice(r+1),a+1)]}function m(t){const a=[];if(t)for(let n=0;n<t.data.length;n+=4){const r={r:t.data[n],g:t.data[n+1],b:t.data[n+2]};a.push(r)}return a}function M(t){let a=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MAX_VALUE,e=Number.MIN_VALUE,o=Number.MIN_VALUE,c=Number.MIN_VALUE;t.forEach(g=>{a=Math.min(a,g.r),n=Math.min(n,g.g),r=Math.min(r,g.b),e=Math.max(e,g.r),o=Math.max(o,g.g),c=Math.max(c,g.b)});const s=e-a,u=o-n,i=c-r,h=Math.max(s,u,i);return h===s?"r":h===u?"g":"b"}function f(t){return t.map(a=>`rgba(${a.r}, ${a.g}, ${a.b}, 1)`)}function d(t){const a=n=>.2126*n.r+.7152*n.g+.0722*n.b;return t.sort((n,r)=>a(r)-a(n))}})();
